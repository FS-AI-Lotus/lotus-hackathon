# Prometheus Configuration for Coordinator Service
# 
# This configuration scrapes metrics from the Coordinator service.
# Designed to easily extend to microservices later.
#
# Note: Hostnames and ports will be injected by Terraform/CI/CD pipeline
# or can be set via environment variables.

global:
  scrape_interval: 15s      # Scrape targets every 15 seconds
  evaluation_interval: 15s  # Evaluate rules every 15 seconds
  external_labels:
    cluster: 'lotus-hackathon'
    team: 'team4'

# Alertmanager configuration (optional - can be configured separately)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           # - 'alertmanager:9093'

# Load alert rules
rule_files:
  - 'alerts.yml'

# Scrape configurations
scrape_configs:
  # Coordinator Service
  - job_name: 'coordinator'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    scheme: 'https'  # Use https for Railway, http for localhost
    tls_config:
      insecure_skip_verify: false  # Railway uses valid SSL certificates - verify them
    static_configs:
      - targets:
          # Coordinator service endpoint
          # 
          # LOCAL DEVELOPMENT: Use localhost:3000
          # PRODUCTION (RAILWAY): Use your Railway URL (see RAILWAY-URL.config)
          # 
          # Current Railway URL: ms8-learning-analytics-production.up.railway.app:443
          # To change: Update the URL below and in RAILWAY-URL.config
          - 'ms8-learning-analytics-production.up.railway.app:443'  # Railway Production
          # - 'localhost:3000'  # Uncomment for local development
        labels:
          service: 'coordinator'
          environment: 'production'  # Change to 'development' for local

  # Placeholder for future microservices
  # Uncomment and configure when microservices are ready
  # - job_name: 'microservices'
  #   scrape_interval: 15s
  #   scrape_timeout: 10s
  #   metrics_path: '/metrics'
  #   static_configs:
  #     - targets:
  #         - 'microservice1:3001'
  #         - 'microservice2:3002'
  #       labels:
  #         service: 'microservices'
  #         environment: '${ENVIRONMENT:-development}'

# Optional: Remote write configuration for Grafana Cloud
# Uncomment to forward metrics directly to Grafana Cloud (alternative to Alloy)
remote_write:
  - url: 'https://prometheus-prod-XX-prod-YY-ZZ.grafana.net/api/prom/push'
    basic_auth:
      username: '${GRAFANA_CLOUD_USERNAME}'
      password: 'YOUR_GRAFANA_CLOUD_TOKEN_HERE'
    queue_config:
      max_samples_per_send: 1000
      max_shards: 200
      capacity: 2500

