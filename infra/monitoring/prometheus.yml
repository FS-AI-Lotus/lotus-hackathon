# Prometheus Configuration for Coordinator Service
# 
# This configuration scrapes metrics from the Coordinator service.
# Designed to easily extend to microservices later.
#
# Note: Hostnames and ports will be injected by Terraform/CI/CD pipeline
# or can be set via environment variables.

global:
  scrape_interval: 15s      # Scrape targets every 15 seconds
  evaluation_interval: 15s  # Evaluate rules every 15 seconds
  external_labels:
    cluster: 'lotus-hackathon'
    team: 'team4'

# Alertmanager configuration (optional - can be configured separately)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           # - 'alertmanager:9093'

# Load alert rules
rule_files:
  - 'alerts.yml'

# Scrape configurations
scrape_configs:
  # Coordinator Service
  - job_name: 'coordinator'
    scrape_interval: 15s
    scrape_timeout: 30s  # Increased timeout for Railway (was 10s)
    metrics_path: '/metrics'
    scheme: 'https'  # Use https for Railway, http for localhost
    tls_config:
      insecure_skip_verify: false  # Railway uses valid SSL certificates - verify them
    static_configs:
      - targets:
          # ============================================================
          # PRODUCTION URL CONFIGURATION - EASY TO CHANGE
          # ============================================================
          # 
          # Current Railway URL: ms8-learning-analytics-production.up.railway.app:443
          # 
          # For local development, comment out the production URL above and
          # uncomment the localhost line below.
          # 
          # To change Railway URL: Update the URL below
          # ============================================================
          - 'ms8-learning-analytics-production.up.railway.app:443'  # Railway Production URL
          # - 'localhost:3000'  # Uncomment this for local development
        labels:
          service: 'coordinator'
          environment: 'production'  # Change to 'development' for local

  # Placeholder for future microservices
  # Uncomment and configure when microservices are ready
  # - job_name: 'microservices'
  #   scrape_interval: 15s
  #   scrape_timeout: 10s
  #   metrics_path: '/metrics'
  #   static_configs:
  #     - targets:
  #         - 'microservice1:3001'
  #         - 'microservice2:3002'
  #       labels:
  #         service: 'microservices'
  #         environment: '${ENVIRONMENT:-development}'

# Optional: Remote write configuration for Grafana Cloud
# Uncomment to forward metrics directly to Grafana Cloud (alternative to Alloy)
# NOTE: If using remote_write, configure credentials via environment variables
# and use a secrets management system. Do not commit API tokens to the repository.
#
# remote_write:
#   - url: 'https://prometheus-prod-XX-prod-YY-ZZ.grafana.net/api/prom/push'
#     basic_auth:
#       username: '${GRAFANA_CLOUD_USERNAME}'
#       password: '${GRAFANA_CLOUD_TOKEN}'
#     queue_config:
#       max_samples_per_send: 1000
#       max_shards: 200
#       capacity: 2500

